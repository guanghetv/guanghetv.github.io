<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>浅谈 NoSql for Android platform | 洋葱数学技术博客</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">浅谈 NoSql for Android platform</h1><a id="logo" href="/.">洋葱数学技术博客</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/bookshelf"><i class="fa fa-book"> 书单</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">浅谈 NoSql for Android platform</h1><div class="post-meta">Mar 12, 2015<span> | </span><span class="category"><a href="/categories/tech/">tech</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2015/03/12/mobile-nosql-db/" href="/2015/03/12/mobile-nosql-db/#comments" class="ds-thread-count"></a><div class="post-content"><p>###支持资料<br><a href="https://android-arsenal.com/tag/155" target="_blank" rel="external">Android Arsenal 站点关于几个Nosql的介绍.</a></p>
<ul>
<li>Realm.</li>
<li>SnappyDB.</li>
<li>SimpleNoSql.</li>
<li>couchbase</li>
</ul>
<p>###Why Use Nosql on Moblie Platform<br>说到在我们的mobile应用中使用Nosql需求: </p>
<ol>
<li><strong>第一是需要做数据缓存</strong>.</li>
<li><strong>第二点是server使用的MongoDB</strong>.</li>
<li><strong>第三点其实和第一点有关联，因为服务端使用的是Document(文档)模型数据存储，请求拉回到移动端时,若使用同样的Nosql数据库格式，就基本无需改动直接存储</strong>  </li>
</ol>
<p>为了最少的对本地缓存数据做数据库设计和建模，就是使用和服务端类似的Nosql来存储数据。<br>其实本来是想使用sharepreference或是文本来做轻量级的缓存。但是考虑到在数据更新和查询时的效率（读一条文档需要read整个文本或是记录集等).</p>
<p>综合的来说:</p>
<ol>
<li>保持客户端和服务端数据存储模型的统一性,无需在设计关系型数据库模型(便洁)。</li>
<li>相对来说直接文本和偏好存储，毕竟专业的nosql数据库具有更好更效率的数据操作。 </li>
</ol>
<p>###关于目前可用的几个Nosql数据的概述</p>
<h2 id="Reaml"><a href="#Reaml" class="headerlink" title="#####Reaml"></a>#####<strong>Reaml</strong></h2><p> Realm ,支持Android和IOS+OSX，Realm for Android 2014.9.30,Realm相对来来说可能算是比较新的一个数据库框架。以Object或是Array形式对数据序列化存储，因为其早期开发的是IOS版本针对coredata存储的改进，所以基本概念中又很多ORM的感觉。<br> 根据<a href="http://realm.io/docs/java/0.78.0/" target="_blank" rel="external">Realm的官方文档</a>教程实践时一般会出现几个问题。  </p>
 <figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Caused <span class="keyword">by</span>: io.realm.exceptions.RealmException: Could <span class="keyword">not</span> find <span class="keyword">the</span> generated proxy  <span class="built_in">class</span>: Annotation processor may <span class="keyword">not</span> have been executed.</div></pre></td></tr></table></figure>
<blockquote>
<p>官方FAQ:<br>What does the exception ‘Annotation processor may not have been executed.’ mean?<br>During compilation of your app, the model classes are processed and proxy classes are generated. If this annotation process fails, the proxy classes or their methods cannot be found. When your app begins running, it Realm will throw exception with message ‘Annotation processor may not have been executed.’. You may see this in case you use Java 6 as it doesn’t support inheriting annotations. You then have to add @RealmClass before your models. Otherwise it can often be solved by removing/cleaning all generated or intermediate files and rebuild.<br>简单的说就是jdk&lt;7的情况下会出现该问题，需要在realmObject前添加注解@RealmClass.</p>
</blockquote>
<p>接下来可能会出现的问题是</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">io<span class="selector-class">.realm</span><span class="selector-class">.exceptions</span><span class="selector-class">.RealmMigrationNeededException</span>: Field <span class="string">'name'</span> not found <span class="keyword">for</span> type <span class="string">'YourBean'</span></div></pre></td></tr></table></figure>
<p>卸载下app清除旧的realmdb，重新运行就ok了。</p>
<p>Reaml的Android版本出的时间不久,他更像定义了一个Model的持久化框架,从对需要持久化的对象需要集成reaml的类，规范和注解的加入。对于稳定性来说,通用功能和常规的数据存储上基本没有问题.<br>官网的有很好的支持文档以及github的star和维护活跃度都是很高。</p>
<p>Tips:<br>Realm和Gson配合使用导致Gson resolve StackOverflowError；<br>官方解决  </p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Gson gson = <span class="keyword">new</span> GsonBuilder()</div><div class="line">                .setExclusionStrategies(<span class="keyword">new</span> ExclusionStrategy() &#123;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">shouldSkipField</span><span class="params">(FieldAttributes f)</span> </span>&#123;</div><div class="line">                        <span class="keyword">return</span> f.getDeclaringClass().equals(RealmObject.class);</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">shouldSkipClass</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</div><div class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .create();</div><div class="line">        String json = <span class="string">"&#123; name : 'John', email : 'john@corporation.com' &#125;"</span>;</div><div class="line">        User user = gson.fromJson(json, User.class);</div></pre></td></tr></table></figure>
<p>但是对于比较复杂的数据存储，比如需要支持对象里面包涵对象，该类也需要是先realmobject;比如list类型的需要是使用reaml提供的reamllist容器。</p>
<h2 id="SnappyDB"><a href="#SnappyDB" class="headerlink" title="#####SnappyDB "></a>#####<strong>SnappyDB</strong> </h2><p>简单粗暴的kv存储模式，可以直接存储一个对象（其机制会帮助你序列化）.假设我有一个同类型的对象数据集，<br>那么只能以array形式存储；查询的时候目前只能根据key值来读取，假设我只需要读取array集合里的某个对象，<br>那么会再取出整个array集合，然后再自己检索（目前从提供的简单的API来看只支持key查询,有兴趣的可以看看具体代码），个人觉得，是sharepreference的一个加强版，从他测试的数据图来说，效率还可以,使用也很简单。</p>
<h2 id="couchbase"><a href="#couchbase" class="headerlink" title="#####couchbase"></a>#####<strong>couchbase</strong></h2><p>从mobile平台的nosql数据库来看，couchbase算比较提及的比较多。<br>支持android，java，ios等多个平台和语言,基于文档形式的存储。<br>但是,其存储接口提供还是需要转为map才能存储，不支持直接JSON存储,虽然它提到最后是已JSON格式存储，<br>但是暴露在API接口上接受的是map。<br>文档默认都会生成一个_id,_rev字段,这在做缓存时会导致和我们本身的一些数据中的_id冲突(目前来看是_id被它自动覆盖了,并且只会发生在文档的最外层的_id)。<br>简单的解决方案是，在需要设置自己的_id时，在创建Document时使用 </p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">Document document</span> = database.getDocument(<span class="string">"myid2123"</span>);</div></pre></td></tr></table></figure>
<p>基于自定义的_id来获取或创建一个Document,也就可以实现默认_id带来的问题，<br>当让前提是我们设计定义_id是需要有唯一性的。</p>
<p>couchbase基本使用步骤:  </p>
<ul>
<li>step1:根据上下文获取一个Manager</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">manager = <span class="keyword">new</span> Manager(<span class="keyword">new</span> AndroidContext(mContext), Manager.DEFAULT_OPTIONS);</div><div class="line"><span class="string">``</span><span class="string">``</span>  </div><div class="line"></div><div class="line">+ step2:通过指定的数据库名获取指定数据库</div></pre></td></tr></table></figure>
<p>this.db = manager.getDatabase(“my-database”);</p>
<pre><code>
+ step3:创建一条记录写入数据库
</code></pre><p>Map<string, object=""> properties = new HashMap<string, object="">();<br>properties.put(“type”, “list”);<br>properties.put(“title”, title);<br>properties.put(“created_at”, currentTimeString);<br>properties.put(“owner”, “profile:” + userId);<br>properties.put(“members”, new<br>ArrayList<string>());<br>Document document = database.createDocument();<br>document.putProperties(properties);<br> ````  </string></string,></string,></p>
<p>具体的深度则可以考虑如何处理并发,锁机制,索引，视图等概念。</p>
<h2 id="SimpleNoSql"><a href="#SimpleNoSql" class="headerlink" title="#####SimpleNoSql"></a>#####<strong>SimpleNoSql</strong></h2><p>略，直接看<a href="https://github.com/Jearil/SimpleNoSQL" target="_blank" rel="external">其github和文档</a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2015/03/12/mobile-nosql-db/" data-id="ciwhh7pkk0009h6azzz9xuqmn" class="article-share-link">分享到</a><div class="tags"><a href="/tags/android-nosql-realm-couchbase/">android,nosql,realm,couchbase</a></div><div class="post-nav"><a href="/2015/04/12/css-summary/" class="pre">css 实践总结</a><a href="/2015/03/02/course-builder-tech-summary/" class="next"></a></div><div data-thread-key="2015/03/12/mobile-nosql-db/" data-title="浅谈 NoSql for Android platform" data-url="http://yoursite.com/2015/03/12/mobile-nosql-db/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2015/03/12/mobile-nosql-db/" data-title="浅谈 NoSql for Android platform" data-url="http://yoursite.com/2015/03/12/mobile-nosql-db/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/news/">news</a><span class="category-list-count">76</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/">tech</a><span class="category-list-count">35</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/android-nosql-realm-couchbase/" style="font-size: 15px;">android,nosql,realm,couchbase</a> <a href="/tags/CI-Appium/" style="font-size: 15px;">CI,Appium</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/12/09/2015-12-8-scapy/">scapy与路由轨迹图</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/05/AppiumTestCase-Python/">Appium Test Case-Python篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/27/how-to-use-react-native-navigator/">如何使用react native中的Navigator组件</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/25/jinkens-PitRecords/">Jinkens+踩坑纪录</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/22/appium-nodeTest/">Appium+nodeJS测试用例编写</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/22/jinkens-iOSTest/">Jinkens+iOS测试</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/06/recovering-a-wiredtiger-collection-from-a-corrupt-wt-file/">从损坏的wt文件中恢复出WiredTiger集合</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/13/best-practice-of-config-for-nodejs-projects/">Nodejs项目配置文件最佳实践</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/16/appium-config/">Mac环境下如何配置Appium</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/16/appium-test/">Appium+Eclipse编写测试用例</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://yangcong345.com/" title="洋葱数学官网" target="_blank">洋葱数学官网</a><ul></ul><a href="https://github.com/guanghetv/" title="Github主页" target="_blank">Github主页</a><ul></ul><a href="https://facebook.github.io/react-native/" title="ReactNative" target="_blank">ReactNative</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">洋葱数学技术博客.</a> Tech<a rel="nofollow" target="_blank" href="https://hexo.io"></a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"></a> <a rel="nofollow" target="_blank" href="https://github.com/pagecho"></a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'antsun'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>