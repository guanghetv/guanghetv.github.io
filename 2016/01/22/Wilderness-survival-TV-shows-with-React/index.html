<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>React 荒野求生指南 | 光合新知技术博客</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">React 荒野求生指南</h1><a id="logo" href="/.">光合新知技术博客</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/bookshelf"><i class="fa fa-book"> 书单</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">React 荒野求生指南</h1><div class="post-meta">Jan 22, 2016<span> | </span><span class="category"><a href="/categories/tech/">tech</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2016/01/22/Wilderness-survival-TV-shows-with-React/" href="/2016/01/22/Wilderness-survival-TV-shows-with-React/#comments" class="ds-thread-count"></a><div class="post-content"><p>作者：吕骚娆</p>
<p>大家好，吕骚娆就是我，我就是美不胜收、无解的智商还有无解的颜艺，美貌与智慧并重，知识和美德的结合体的吕骚娆。我将在这篇文章中介绍我在使用React和Redux写code时的心得。</p>
<h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>流行的名词都是噱头，我们的目标是<code>没有蛀牙</code></p>
<p>在这篇文章将介绍以下有关React的东西：</p>
<ol>
<li>React的概念</li>
<li>如何应用好React？</li>
<li>Redux的概念</li>
<li>Redux和React在一起时的组成部分</li>
<li>immutable-js和Redux</li>
</ol>
<p>以上内容想到哪儿写哪儿。这篇文章不应该面向没用写过React和Redux的人，我假设你有一定的React编程基础，用React和Redux写过一些案例。我将不会介绍细节，但保证干货。不会出现屁用都没有的老生常谈的东西，但代价是你需要提前体验过React，这些内容才会加深你对React的理解。</p>
<h1 id="React？"><a href="#React？" class="headerlink" title="React？"></a>React？</h1><p><code>React本质上是一个view层</code>，但这个说法太过混淆和不负责任。React是一个状态机，通过状态的改变来调用Render事件重新计算和渲染Dom。</p>
<p>除此之外，使用React本质上是在做面向过程式编程，先按下不表。</p>
<p>状态鸡接受两种状态：<code>state</code>和<code>props</code>。<code>state</code>是一个React Component内部的状态；与之相对的<code>props</code>是Component接受的外部对其Component的状态。不论是<code>state</code>和<code>props</code>哪一个发生改变，都会调用这个Component的Render方法进行重新计算。</p>
<p>Render方法会渲染你想要的Dom，React围绕着Render方法进行创建了一套生命周期。这套生命周期共7个事件、两个初始化方法，按照一个React Component被执行的时间顺序为：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">getInitialState  <span class="comment">// 初始化 state</span></div><div class="line">getDefaultProps  <span class="comment">// 设置默认的 props，如果外部没用传递props则使用默认的props</span></div><div class="line">componentWillMount  <span class="comment">// 组件即将 Render 之前，不经常用到</span></div><div class="line">render</div><div class="line">componentDidMount   <span class="comment">// 组件第一次 Render 之后</span></div><div class="line"><span class="function"><span class="title">componentWillReceiveProps</span><span class="params">(nextProps)</span></span>        <span class="comment">// 组件接收到新的 props，要被 update 时。这个方法最大的作用就是你需要在 props 被更新的同时更新 state，调用 this.setState 方法不会触发两次 Render 事件</span></div><div class="line"><span class="function"><span class="title">shouldComponentUpdate</span><span class="params">(nextProps, nextState)</span></span>         <span class="comment">// 你拿到即将被接收的两种状态，与现在的进行对比，你可以返回 false 来阻止这次组件被 update。当你 App 逻辑复杂，使用 Redux 传递对象时，你会经常用到这个方法。</span></div><div class="line"><span class="function"><span class="title">componentWillUpdate</span><span class="params">(nextProps, nextState)</span></span>   <span class="comment">// 组件即将被更新，不经常用到，不应该在此处更新内部状态 state</span></div><div class="line">render</div><div class="line"><span class="function"><span class="title">componentDidUpdate</span><span class="params">(nextProps, nextState)</span></span> <span class="comment">// 当组件被更新之后，你可以在此处触发动画</span></div><div class="line">componentWillUnmount    <span class="comment">// 组件将被移除时，你可以在此处销毁setTimeInterval变量等。</span></div></pre></td></tr></table></figure>
<p>React作为一个view层的精妙之处就在与完善的生命周期和组件和组件之间的协作方式，就是刚刚提到的面向过程式编程，接下来为你介绍组件之间协作时要<code>必须</code>遵守的哲学。</p>
<p>#如何应用好React？<br>你在创建一个React应用时，请务必谨记——将应用的组件分为<code>容器视图</code>和<code>表现视图</code>，在设计目录结构时，你可以这样设计：</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">react-app/src/ +  </div><div class="line">        </div><div class="line">        —— <span class="string">| app/                   放置 React 容器视图</span></div><div class="line">            —— <span class="string">| exercise.js</span></div><div class="line"></div><div class="line">        —— <span class="string">| components/            放置 React 表现视图</span></div><div class="line">            —— <span class="string">| exercise/</span></div><div class="line">                —— <span class="string">| dataLoading.js</span></div><div class="line">                —— <span class="string">| header.js</span></div><div class="line">                —— <span class="string">| mainContent.js</span></div><div class="line">                —— <span class="string">| softkeyboard.js</span></div><div class="line">                </div><div class="line">        —— index.html               单页应用的基础html文件</div><div class="line"></div><div class="line">        —— module.js                程序入口，初始化 React Router，调用容器视图</div></pre></td></tr></table></figure>
<p>明白我的意思了吗？React组件是要和数据相连接的，数据的流向应该时从容器视图以传递<code>props</code>的方式流入表现视图的，举个例子，下面的图片是我的容器视图，它使用了Redux数据流。</p>
<!-- 博客中实际相对路径 -->
<p><img src="/assets/images/1231672387142375462345245.png" alt=""></p>
<p>图片中如果有你看不懂的东西不要在意，我只是希望你知道在你的App规模变得复杂时，在<code>容器视图</code>和<code>表现视图</code>之间使用<code>props</code>的方式传递参数有多么必要。当你的数据流使用Redux进行管理时，它会让你的App井然有序，<code>容器视图</code>就想一个列表一样，将所有有关数据（这里指的数据还包括UI的状态）的操作罗列出来。但还不止如此，接下来就介绍Redux。</p>
<p>#Redux的概念<br>Redux是一种数据的管理方式的库，通过dispatch一个Action，Redux Reducer会处理这个Action，并将结果更新至store（在Redux中叫做state）。<br>使用Redux的好处在于，你会用Redux管理数据、React Component 之间跨组件的UI状态，你可以非常方便的添加<a href="http://redux.js.org/docs/api/applyMiddleware.html" target="_blank" rel="external">middleware</a>在每一个action被发起和数据更改后的状态，像这样：</p>
<!-- 博客中实际相对路径 -->
<p><img src="/assets/images/1231378236428345245.png" alt=""></p>
<p>你还可以在发起Action后捕获出现的异常，将它们发送至服务器记录。你做test case时也比一般应用要简单的多，因为数据的更改全部通过Action，没有其它的更改办法。</p>
<p>#Redux和React在一起时的组成部分</p>
<p>在你使用React的<code>容器视图</code>与Redux store <a href="https://github.com/rackt/react-redux" target="_blank" rel="external">connect</a>之后，store一旦被更新，就会将新的数据以props的方式传递给你的<code>容器视图</code>，这个数据不一定是整个Store，而可以是一个预加工过的store，通过<a href="https://github.com/rackt/reselect" target="_blank" rel="external">Selector</a>进行计算后的数据。这是因为Redux提倡整个App只有一个Store的存在，但你可能有多个不相关的<code>容器视图</code>，你需要<a href="https://github.com/rackt/reselect" target="_blank" rel="external">Selector</a>来帮你预计算和缓存。</p>
<p>你的<code>容器视图</code>收到<code>props</code>后一旦被Render，你的<code>表现视图</code>也会接收到新的<code>props</code>，整个App被更新。</p>
<p>相对的，如果你不使用过程式编程的思想在<code>容器视图</code>和<code>表现视图</code>之间传递<code>props</code>，而是将store与每一个<code>表现视图</code>之间connect，将会极大造成效率问题，不适合构建大型应用，逻辑也不够清晰。</p>
<p>#immutable-js和Redux</p>
<p>Redux提倡在Reducer中计算时不要更改一份旧的数据，而是创建一份新的数据，也不要在Reducer外修改Store中的数据。深拷贝无疑将造成效率问题。所以我们的目光投向了immutable-js。</p>
<p>再也没有比immutable-js更适合和Redux进行一起服用的解决方案了。</p>
<p>immutable-js的<a href="https://en.wikipedia.org/wiki/Persistent_data_structure" target="_blank" rel="external">实现</a>类似于链表，添加一个新结点把旧结点的父子关系转移到新结点上，性能提升很多。由于是不可变的，可以放心的对对象进行任意操作。在React开发中，频繁操作state对象或是store，配合immutable-js快、安全、方便。</p>
<p>#结语<br>总的来说这篇文章并不是教你如何写出一个Demo，而是分享我在开发时的经验，希望这些经验在你开发时带给你灵感。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/01/22/Wilderness-survival-TV-shows-with-React/" data-id="ciwhh0l1i005kfraz9ybgx78e" class="article-share-link">分享到</a><div class="tags"></div><div class="post-nav"><a href="/2016/01/27/Mongoose-History-Plugin/" class="pre">Mongoose History Plugin</a><a href="/2016/01/18/git-commit-written-guide/" class="next">Commit Message 编写指南</a></div><div data-thread-key="2016/01/22/Wilderness-survival-TV-shows-with-React/" data-title="React 荒野求生指南" data-url="http://yoursite.com/2016/01/22/Wilderness-survival-TV-shows-with-React/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/01/22/Wilderness-survival-TV-shows-with-React/" data-title="React 荒野求生指南" data-url="http://yoursite.com/2016/01/22/Wilderness-survival-TV-shows-with-React/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/news/">news</a><span class="category-list-count">76</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/">tech</a><span class="category-list-count">35</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/android-nosql-realm-couchbase/" style="font-size: 15px;">android,nosql,realm,couchbase</a> <a href="/tags/CI-Appium/" style="font-size: 15px;">CI,Appium</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/12/09/2015-12-8-scapy/">scapy与路由轨迹图</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/05/AppiumTestCase-Python/">Appium Test Case-Python篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/27/how-to-use-react-native-navigator/">如何使用react native中的Navigator组件</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/25/jinkens-PitRecords/">Jinkens+踩坑纪录</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/22/jinkens-iOSTest/">Jinkens+iOS测试</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/22/appium-nodeTest/">Appium+nodeJS测试用例编写</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/06/recovering-a-wiredtiger-collection-from-a-corrupt-wt-file/">从损坏的wt文件中恢复出WiredTiger集合</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/13/best-practice-of-config-for-nodejs-projects/">Nodejs项目配置文件最佳实践</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/16/appium-test/">Appium+Eclipse编写测试用例</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/16/appium-config/">Mac环境下如何配置Appium</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://yangcong345.com/" title="洋葱数学官网" target="_blank">洋葱数学官网</a><ul></ul><a href="https://github.com/guanghetv/" title="Github主页" target="_blank">Github主页</a><ul></ul><a href="https://facebook.github.io/react-native/" title="ReactNative" target="_blank">ReactNative</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">光合新知技术博客.</a> Tech<a rel="nofollow" target="_blank" href="https://hexo.io"></a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"></a> <a rel="nofollow" target="_blank" href="https://github.com/pagecho"></a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'antsun'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>